<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of amat</title>
  <meta name="keywords" content="amat">
  <meta name="description" content="find A matrix from one turn map matrix">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">atmat</a> &gt; <a href="../index.html">pubtools</a> &gt; <a href="index.html">local_lattice_params</a> &gt; amat.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for atmat/pubtools/local_lattice_params&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>amat
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>find A matrix from one turn map matrix</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function a=amat(m66) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">find A matrix from one turn map matrix
Order it so that it is close to the order of x,y,z
also ensure that positive modes are before negative so that
one has proper symplecticity
B. Nash July 18, 2013
we order and normalize the vectors via 
 v_j' jmat(3) v_k = i sgn(j) delta(j,k)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="jmat.html" class="code" title="function mat=jmat(n)">jmat</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="get_dispersion_from_etaoids.html" class="code" title="function disp = get_dispersion_from_etaoids(ring,refpts)">get_dispersion_from_etaoids</a>	get_dispersion_from_etaoids computes dispersion functions (x,px,y,py) at refpts</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function a=amat(m66)</a>
0002 <span class="comment">%find A matrix from one turn map matrix</span>
0003 <span class="comment">%Order it so that it is close to the order of x,y,z</span>
0004 <span class="comment">%also ensure that positive modes are before negative so that</span>
0005 <span class="comment">%one has proper symplecticity</span>
0006 <span class="comment">%B. Nash July 18, 2013</span>
0007 <span class="comment">%we order and normalize the vectors via</span>
0008 <span class="comment">% v_j' jmat(3) v_k = i sgn(j) delta(j,k)</span>
0009 [V,d]=eigs(m66);
0010 v1=V(:,1);
0011 v2=V(:,2);
0012 v3=V(:,3);
0013 v4=V(:,4);
0014 v5=V(:,5);
0015 v6=V(:,6);
0016 
0017 <span class="comment">%compute norms of each:</span>
0018 <span class="keyword">for</span> j=1:6
0019 n(j)=-(1/2)*i*V(:,j)'*<a href="jmat.html" class="code" title="function mat=jmat(n)">jmat</a>(3)*V(:,j);
0020 <span class="keyword">end</span>
0021 
0022 <span class="comment">%put positive modes before negative modes (swap columns if first n in pair</span>
0023 <span class="comment">%is negative)</span>
0024 <span class="keyword">for</span> j=1:3
0025     <span class="keyword">if</span> n(2*j-1) &lt;0 
0026         V(:,[2*j-1,2*j]) = V(:,[2*j,2*j-1]);
0027         n([2*j-1,2*j]) = n([2*j,2*j-1]);
0028     <span class="keyword">end</span>
0029 <span class="keyword">end</span>
0030 <span class="comment">%now normalize each vector</span>
0031 
0032 <span class="keyword">for</span> j=1:6
0033     Vn(:,j)=V(:,j)/sqrt(abs(n(j)));
0034 <span class="keyword">end</span>
0035 
0036 <span class="comment">%find the vecs that project most onto x,y,z, and reorder</span>
0037 <span class="comment">%call these vectors Vxyz, ordered via (vx,vmx,vy,vmy,vz,vmz)</span>
0038 Vxyz(:,1)=(1/sqrt(2))*[i 1 0 0 0 0]';
0039 Vxyz(:,2)=i*conj(Vxyz(:,1));
0040 Vxyz(:,3)=(1/sqrt(2))*[0 0 i 1 0 0]';
0041 Vxyz(:,4)=i*conj(Vxyz(:,3));
0042 Vxyz(:,5)=(1/sqrt(2))*[0 0 0 0 i 1]';
0043 Vxyz(:,6)=i*conj(Vxyz(:,5));
0044 
0045 <span class="keyword">for</span> j=1:6
0046     <span class="keyword">for</span> k=1:6
0047         nn(j,k) = (1/2)*abs(sqrt(-i*Vn(:,j)'*<a href="jmat.html" class="code" title="function mat=jmat(n)">jmat</a>(3)*Vxyz(:,k)));
0048     <span class="keyword">end</span>
0049 <span class="keyword">end</span>
0050 
0051 <span class="comment">%now use nn to order pairs</span>
0052 n1 = nn(1,[1,3,5]);
0053 n3 = nn(3,[1,3,5]);
0054 n5 = nn(5,[1,3,5]);
0055 
0056 [vals1,sind1]=sort(n1,<span class="string">'descend'</span>);
0057 [vals3,sind3]=sort(n3,<span class="string">'descend'</span>);
0058 [vals5,sind5]=sort(n5,<span class="string">'descend'</span>);
0059 
0060 orderp = [2*sind1(1)-1,2*sind3(1)-1,2*sind5(1)-1];
0061 ordern = [2*sind1(1),2*sind3(1),2*sind5(1)];
0062 
0063 V_ordered = Vn;
0064 V_ordered(:,[1,3,5])=V_ordered(:,orderp); <span class="comment">%reorder positive modes</span>
0065 V_ordered(:,[2,4,6])=V_ordered(:,ordern); <span class="comment">%reorder negative modes</span>
0066 
0067 <span class="comment">%build A matrix</span>
0068 a=[real(V_ordered(:,1)) imag(V_ordered(:,1)) real(V_ordered(:,3)) imag(V_ordered(:,3)) real(V_ordered(:,5)) imag(V_ordered(:,5))];
0069 
0070 <span class="comment">%return</span>
0071 
0072</pre></div>
<hr><address>Generated on Sun 28-Jul-2013 23:18:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>