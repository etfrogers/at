<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of misalign</title>
  <meta name="keywords" content="misalign">
  <meta name="description" content="THERING = MISALIGN(misaligndata) will go through THERING and">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">atmat</a> &gt; <a href="../index.html">pubtools</a> &gt; <a href="index.html">misalignment</a> &gt; misalign.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for atmat/pubtools/misalignment&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>misalign
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>THERING = MISALIGN(misaligndata) will go through THERING and</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function varargout = misalign(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> THERING = MISALIGN(misaligndata) will go through THERING and
 generage the misalignment based on the information provided in
 misaligndata which is generated by setmisalignment.

 See also MISALIGNDATA</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function randnum = generaterandom(sigma,num,cutoff)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = misalign(varargin)</a>
0002 <span class="comment">% THERING = MISALIGN(misaligndata) will go through THERING and</span>
0003 <span class="comment">% generage the misalignment based on the information provided in</span>
0004 <span class="comment">% misaligndata which is generated by setmisalignment.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% See also MISALIGNDATA</span>
0007 
0008 <span class="comment">% misalign.individual(n).name</span>
0009 <span class="comment">%                       .onesigma.x</span>
0010 <span class="comment">%                                .y</span>
0011 <span class="comment">%                                .z</span>
0012 <span class="comment">%                                .thetax</span>
0013 <span class="comment">%                                .thetay</span>
0014 <span class="comment">%                                .thetaz</span>
0015 <span class="comment">%                       .cutoff</span>
0016 <span class="comment">%                       .index             (optional)</span>
0017 <span class="comment">% misalign.girder(n).name</span>
0018 <span class="comment">%                   .firstelement</span>
0019 <span class="comment">%                   .lastelement</span>
0020 <span class="comment">%                   .onesigma.x</span>
0021 <span class="comment">%                            .y</span>
0022 <span class="comment">%                            .z</span>
0023 <span class="comment">%                            .thetax</span>
0024 <span class="comment">%                            .thetay</span>
0025 <span class="comment">%                            .thetaz</span>
0026 <span class="comment">%                   .cutoff</span>
0027 <span class="comment">%                   .index             (optional)</span>
0028 <span class="comment">% misalign.startelementindex</span>
0029 <span class="comment">% misalign.time</span>
0030 <span class="comment">% misalign.title</span>
0031 <span class="comment">% midalign.data.element(n).name (?)</span>
0032 <span class="comment">%                         .ATindex</span>
0033 <span class="comment">%                         .x</span>
0034 <span class="comment">%                         .y</span>
0035 <span class="comment">%                         .z</span>
0036 <span class="comment">%                         .thetax</span>
0037 <span class="comment">%                         .thetay</span>
0038 <span class="comment">%                         .thetaz</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% Assumes THERING is the definition of the lattice that the misalignment</span>
0041 <span class="comment">% will be affecting.</span>
0042 
0043 <span class="keyword">global</span> THERING
0044 
0045 <span class="comment">% Parse input parameters</span>
0046 <span class="keyword">for</span> i=1:nargin
0047     <span class="keyword">if</span> isstruct(varargin{i})
0048         misaligndata = varargin{i};
0049     <span class="keyword">else</span>
0050         disp([<span class="string">'Parameter number '</span> num2str(i) <span class="string">' not recognised.'</span>]);
0051     <span class="keyword">end</span>
0052 <span class="keyword">end</span>
0053 
0054 misaligndata.individual(1).name = <span class="string">'halfqd'</span>;
0055 misaligndata.individual(1).sigma.x = 1e-2;
0056 misaligndata.individual(1).sigma.y = 1e-2;
0057 misaligndata.individual(1).sigma.z = 1e-2;
0058 misaligndata.individual(1).sigma.thetax = 1e-3;
0059 misaligndata.individual(1).sigma.thetay = 1e-3;
0060 misaligndata.individual(1).sigma.thetaz = 1e-3;
0061 misaligndata.individual(1).cutoff = 2;
0062 misaligndata.individual(2).name = <span class="string">'halfqf'</span>;
0063 misaligndata.individual(2).sigma.x = 1e-2;
0064 misaligndata.individual(2).sigma.y = 1e-2;
0065 misaligndata.individual(2).sigma.z = 1e-2;
0066 misaligndata.individual(2).sigma.thetax = 1e-3;
0067 misaligndata.individual(2).sigma.thetay = 1e-3;
0068 misaligndata.individual(2).sigma.thetaz = 1e-3;
0069 misaligndata.individual(2).cutoff = 2;
0070 
0071 <span class="comment">% Apply individual magnet misalignment</span>
0072 <span class="keyword">for</span> i=1:length(misaligndata.individual)
0073     indices = findcells(THERING,<span class="string">'FamName'</span>,misaligndata.individual(i).name);
0074     <span class="keyword">if</span> ~isempty(indices)
0075         xshift = <a href="#_sub1" class="code" title="subfunction randnum = generaterandom(sigma,num,cutoff)">generaterandom</a>(misaligndata.individual(i).sigma.x,length(indices),misaligndata.individual(i).cutoff);
0076         yshift = <a href="#_sub1" class="code" title="subfunction randnum = generaterandom(sigma,num,cutoff)">generaterandom</a>(misaligndata.individual(i).sigma.y,length(indices),misaligndata.individual(i).cutoff);
0077         addshift(indices,xshift,yshift);
0078 
0079         <span class="comment">% This is not used yet</span>
0080         <span class="comment">%     zshift = generaterandom(misaligndata.individual(i).sigma.z,misaligndata.individual(i).cutoff);</span>
0081 
0082         xrot = <a href="#_sub1" class="code" title="subfunction randnum = generaterandom(sigma,num,cutoff)">generaterandom</a>(misaligndata.individual(i).sigma.thetax,length(indices),misaligndata.individual(i).cutoff);
0083         yrot = <a href="#_sub1" class="code" title="subfunction randnum = generaterandom(sigma,num,cutoff)">generaterandom</a>(misaligndata.individual(i).sigma.thetay,length(indices),misaligndata.individual(i).cutoff);
0084         srot = <a href="#_sub1" class="code" title="subfunction randnum = generaterandom(sigma,num,cutoff)">generaterandom</a>(misaligndata.individual(i).sigma.thetaz,length(indices),misaligndata.individual(i).cutoff);
0085         addxrot(indices,xrot);
0086         addyrot(indices,yrot);
0087         addsrot(indices,srot);
0088     <span class="keyword">end</span>
0089 <span class="keyword">end</span>
0090 
0091 <span class="comment">% To store a local copy of the RING elements without the drift elements.</span>
0092 <span class="comment">% Will aso scan through and determine which group of elements belong to</span>
0093 <span class="comment">% which girder and retrieve the relavent indices. LOCALRINGMAP is a</span>
0094 <span class="comment">% mapping from LOCALRING to the RING elements.</span>
0095 localring = {};
0096 localringmap = [];
0097 ind = 0;
0098 girdernumber = 0;
0099 <span class="keyword">for</span> i=1:length(ring)
0100     <span class="keyword">if</span> ~isempty(regexp(ring{i}.PassMethod,<span class="string">'MPole'</span>)) | <span class="keyword">...</span>
0101             ~isempty(regexp(ring{i}.PassMethod,<span class="string">'Linear'</span>))
0102 
0103         ind = ind + 1;
0104         localring{ind} = ring{i};
0105         localringmap(ind) = i;
0106     <span class="keyword">end</span>
0107 
0108 <span class="keyword">end</span>
0109 
0110 
0111 <a name="_sub1" href="#_subfunctions" class="code">function randnum = generaterandom(sigma,num,cutoff)</a>
0112 
0113 randnum = sigma*randn(1,num);
0114 
0115 ind = find(abs(randnum) &gt; cutoff*sigma);
0116 <span class="keyword">while</span> ~isempty(ind)
0117     randnum(ind) = sigma*randn(1,length(ind));
0118     ind = find(abs(randnum) &gt; cutoff*sigma);
0119 <span class="keyword">end</span>
0120 
0121 randnum(find(randnum &gt; cutoff*sigma))  =  cutoff*sigma;
0122 randnum(find(randnum &lt; -cutoff*sigma)) = -cutoff*sigma;</pre></div>
<hr><address>Generated on Sun 28-Jul-2013 23:18:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>