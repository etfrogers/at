<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of testmisalignfunctions</title>
  <meta name="keywords" content="testmisalignfunctions">
  <meta name="description" content="% Test Misalignment Functions">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">atmat</a> &gt; <a href="../index.html">pubtools</a> &gt; <a href="index.html">misalignment</a> &gt; testmisalignfunctions.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for atmat/pubtools/misalignment&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>testmisalignfunctions
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Test Misalignment Functions</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Test Misalignment Functions

 The purpose is of this script is to go though a sequence of steps to
 verify that the misalignments and the statistics collected are correct.
 Begin with some initialisations.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>	APPLYMISALIGN will read the misalignment data structure and apply it to</li><li><a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>	Lattice definition file - generated by dimad2at v1.300000</li><li><a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>	CALCMISALIGN will load the misalign data from the base application user</li><li><a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>	DELETEMISALIGN will delete the misalignment data structure.</li><li><a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a>	PRINTMISALIGN will give a short display of the misalignements being</li><li><a href="setgirdermisalign.html" class="code" title="function varargout = setgirdermisalign(varargin)">setgirdermisalign</a>	SETGIRDERMISALIGN will add/generate a misalignment structure for THERING that</li><li><a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>	SETMISALIGN will add/generate a misalignment structure for THERING that</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Test Misalignment Functions</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% The purpose is of this script is to go though a sequence of steps to</span>
0004 <span class="comment">% verify that the misalignments and the statistics collected are correct.</span>
0005 <span class="comment">% Begin with some initialisations.</span>
0006 
0007 x_error = 1e-4;
0008 y_error = 1e-4;
0009 
0010 <span class="comment">%% Test CALCMISALIGN</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% Check the distributions that are calculated by this function. Can do this</span>
0013 <span class="comment">% by setting the misalignment for one element and calculating 10000 seeds</span>
0014 <span class="comment">% and plot the histogram.</span>
0015 
0016 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0017 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0018 
0019 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[x_error 0 0 0 0 0],0);
0020 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(10000,<span class="string">'normal'</span>);
0021 mis = getappdata(0,<span class="string">'MisalignData'</span>);
0022 figure; hist(mis.data(7).val(1,:));
0023 fprintf(<span class="string">'''normal'' Mean: %f      Deviation: %f\n'</span>,<span class="keyword">...</span>
0024     mean(mis.data(7).val(1,:)),std(mis.data(7).val(1,:)));
0025 fprintf(<span class="string">'Expect   Mean:~%f      Deviation:~%f\n'</span>,0,x_error);
0026 
0027 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(10000,<span class="string">'sho'</span>);
0028 mis = getappdata(0,<span class="string">'MisalignData'</span>);
0029 figure; hist(mis.data(7).val(1,:));
0030 fprintf(<span class="string">'''sho''    Mean: %f      Deviation: %f\n'</span>,<span class="keyword">...</span>
0031     mean(mis.data(7).val(1,:)),std(mis.data(7).val(1,:)));
0032 
0033 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(10000,<span class="string">'equal'</span>);
0034 mis = getappdata(0,<span class="string">'MisalignData'</span>);
0035 figure; hist(mis.data(7).val(1,:));
0036 fprintf(<span class="string">'''equal''  Mean: %f      Deviation: %f\n'</span>,<span class="keyword">...</span>
0037     mean(mis.data(7).val(1,:)),std(mis.data(7).val(1,:)));
0038 
0039 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(10000,<span class="string">'abs'</span>);
0040 mis = getappdata(0,<span class="string">'MisalignData'</span>);
0041 figure; hist(mis.data(7).val(1,:));
0042 fprintf(<span class="string">'''abs''    Mean: %f      Deviation: %f\n'</span>,<span class="keyword">...</span>
0043     mean(mis.data(7).val(1,:)),std(mis.data(7).val(1,:)));
0044 fprintf(<span class="string">'Expect   Mean: %f      Deviation: %f\n'</span>,x_error,0);
0045 
0046 <span class="comment">%% Test APPLYMISALIGN</span>
0047 <span class="comment">%</span>
0048 <span class="comment">% Make sure that when the calculated misalignments are applied they are</span>
0049 <span class="comment">% assigned to the correct elements and that it was done 'truthfully'. The</span>
0050 <span class="comment">% first test below is just for a single element</span>
0051 
0052 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0053 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0054 
0055 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[x_error 0 0 0 0 0],0);
0056 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>);
0057 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>;
0058 fprintf(<span class="string">'Misalign: %f   Expect: %f\n'</span>,THERING{7}.T2(1),x_error);
0059 
0060 <span class="comment">%%</span>
0061 <span class="comment">% Stacking misalignments</span>
0062 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0063 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0064 
0065 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[x_error 0 0 0 0 0],0);
0066 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[x_error 0 0 0 0 0],0);
0067 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[x_error 0 0 0 0 0],0);
0068 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>);
0069 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>;
0070 fprintf(<span class="string">'Misalign: %f   Expect: %f\n'</span>,THERING{7}.T2(1),x_error*3);
0071 
0072 <span class="comment">%%</span>
0073 <span class="comment">% Only printing out the horizontal shift. Q1 should be nonzero and all the</span>
0074 <span class="comment">% rest should be 0. This test the assignment of multiple elements of one</span>
0075 <span class="comment">% family.</span>
0076 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0077 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0078 
0079 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(<span class="string">'q1'</span>,[x_error 0 0 0 0 0],0);
0080 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>);
0081 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>;
0082 <span class="keyword">for</span> i=1:length(THERING)
0083     <span class="keyword">if</span> strcmpi(THERING{i}.FamName,<span class="string">'q1'</span>)
0084         fprintf(<span class="string">'\n q1 (%03d): %f\n'</span>,i,THERING{i}.T2(1));
0085     <span class="keyword">elseif</span> isfield(THERING{i},<span class="string">'T2'</span>)
0086         fprintf(<span class="string">'%s(%3.2e) '</span>,THERING{i}.FamName,THERING{i}.T2(1));
0087     <span class="keyword">end</span>
0088 <span class="keyword">end</span>
0089 fprintf(<span class="string">'\nExpect horizontal misalignment of ''q1'': %f\n'</span>,x_error);
0090 clear i;
0091 
0092 <span class="comment">%%</span>
0093 <span class="comment">% Multiple elements of multiple families</span>
0094 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0095 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0096 
0097 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>({<span class="string">'q1'</span> <span class="string">'q2'</span>},[x_error 0 0 0 0 0],0);
0098 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>);
0099 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>;
0100 <span class="keyword">for</span> i=1:length(THERING)
0101     <span class="keyword">if</span> strcmpi(THERING{i}.FamName,<span class="string">'q1'</span>)
0102         fprintf(<span class="string">'\n q1 (%03d): %f\n'</span>,i,THERING{i}.T2(1));
0103     <span class="keyword">elseif</span> strcmpi(THERING{i}.FamName,<span class="string">'q2'</span>)
0104         fprintf(<span class="string">'\n q2 (%03d): %f\n'</span>,i,THERING{i}.T2(1));
0105     <span class="keyword">elseif</span> isfield(THERING{i},<span class="string">'T2'</span>)
0106         fprintf(<span class="string">'%s(%3.2e) '</span>,THERING{i}.FamName,THERING{i}.T2(1));
0107     <span class="keyword">end</span>
0108 <span class="keyword">end</span>
0109 fprintf(<span class="string">'\nExpect horizontal misalignment of ''q1'': %f\n'</span>,x_error);
0110 clear i;
0111 
0112 <span class="comment">%%</span>
0113 <span class="comment">% Prettty sure that whats output by the random number generator acutally</span>
0114 <span class="comment">% gets to THERING, therefore now test something else. Calculating more than</span>
0115 <span class="comment">% one set of seeds and applying each on individually and checking that</span>
0116 <span class="comment">% different seeds are being loaded and that you can reload previous seeds</span>
0117 <span class="comment">% that were used.</span>
0118 
0119 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0120 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0121 
0122 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(<span class="string">'q1'</span>,[x_error 0 0 0 0 0],0);
0123 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(3,<span class="string">'normal'</span>);
0124 q1mis = zeros(28,3);
0125 <span class="keyword">for</span> j=1:3
0126     <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>;
0127     temp = 0;
0128     <span class="keyword">for</span> i=1:length(THERING)
0129         <span class="keyword">if</span> strcmpi(THERING{i}.FamName,<span class="string">'q1'</span>)
0130             temp = temp + 1;
0131             q1mis(temp,j) = THERING{i}.T2(1);
0132         <span class="keyword">end</span>
0133     <span class="keyword">end</span>
0134 <span class="keyword">end</span>
0135 
0136 <span class="comment">% Calculate the correlation factor for the three different combinations to</span>
0137 <span class="comment">% determine if any of the sets of seeds are repeated. Correlation factor</span>
0138 <span class="comment">% should be small for all three</span>
0139 disp(<span class="string">'Expect samll correlation factors, k, for the three cases:'</span>);
0140 k = mean(q1mis(:,1).*q1mis(:,2))/<span class="keyword">...</span>
0141     sqrt(mean(q1mis(:,1).^2)*mean(q1mis(:,2).^2))
0142 k = mean(q1mis(:,2).*q1mis(:,3))/<span class="keyword">...</span>
0143     sqrt(mean(q1mis(:,2).^2)*mean(q1mis(:,3).^2))
0144 k = mean(q1mis(:,1).*q1mis(:,3))/<span class="keyword">...</span>
0145     sqrt(mean(q1mis(:,1).^2)*mean(q1mis(:,3).^2))
0146 
0147 <span class="comment">% Apply the seed number 2 again and store the misalignments from THERING.</span>
0148 <span class="comment">% Comparison of the current misalignment and that stored in q1mis(:,2)</span>
0149 <span class="comment">% should produce a correlation factor of 1.</span>
0150 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>(2);
0151 temp = 0;
0152 <span class="keyword">for</span> i=1:length(THERING)
0153     <span class="keyword">if</span> strcmpi(THERING{i}.FamName,<span class="string">'q1'</span>)
0154         temp = temp + 1;
0155         q1mis(temp,4) = THERING{i}.T2(1);
0156     <span class="keyword">end</span>
0157 <span class="keyword">end</span>
0158 disp(<span class="string">'Expect correlation of 1 below:'</span>)
0159 k = mean(q1mis(:,2).*q1mis(:,4))/<span class="keyword">...</span>
0160     sqrt(mean(q1mis(:,2).^2)*mean(q1mis(:,4).^2))
0161 
0162 clear q1mis k temp j;
0163 
0164 <span class="comment">%% Test PRINTMISALIGN</span>
0165 <span class="comment">%</span>
0166 <span class="comment">% The function prints out to the screen or a file the misalignments of each</span>
0167 <span class="comment">% individual misalignment or collects the mean and deviation statistics for</span>
0168 <span class="comment">% a family of elements. This can be verified by setting the misalignments</span>
0169 <span class="comment">% all to one value only, therefore we know the mean and deviation (which</span>
0170 <span class="comment">% will be 0). Secondly use a normal distribution with a sigma of X, and the</span>
0171 <span class="comment">% statistics should also show a deviation ~X.</span>
0172 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0173 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0174 
0175 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(<span class="string">'q1'</span>,[x_error 0 0 0 0 0],0);
0176 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>);
0177 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>;
0178 <a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a> q1
0179 disp([<span class="string">'Expect to see an x deviation of zero and a mean of '</span> num2str(x_error)])
0180 
0181 <span class="comment">%%</span>
0182 <span class="comment">% Display the individual magnet misalignments</span>
0183 <a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a> q1 ind
0184 
0185 <span class="comment">%%</span>
0186 <span class="comment">% Display the individual magnet misalignments for all elements</span>
0187 <a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a> ind file test.txt
0188 edit test.txt
0189 
0190 <span class="comment">%%</span>
0191 <span class="comment">% Calculate the statistics for the normal distribution.</span>
0192 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'normal'</span>);
0193 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>;
0194 <a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a> q1
0195 disp([<span class="string">'Expect to see an x deviation around zero and a mean of ~'</span> num2str(x_error)])
0196 
0197 
0198 <span class="comment">%% Test Misalignment Operations</span>
0199 <span class="comment">%</span>
0200 <span class="comment">% By now we should be confident that the various tools put in place</span>
0201 <span class="comment">% faithfully does the translations, however there are rotations that have</span>
0202 <span class="comment">% to be checked out to ensure that they follow the right hand rule for</span>
0203 <span class="comment">% rotation, especially for the girders.</span>
0204 <span class="comment">%</span>
0205 <span class="comment">% Additionally some tests will be carried out to ensure that the shifts and</span>
0206 <span class="comment">% rotations are realistic by looking at the effect on the optics.</span>
0207 <span class="comment">%</span>
0208 <span class="comment">%% Test SETMISALIGN rotations in x and y</span>
0209 <span class="comment">%</span>
0210 <span class="comment">% A rotation about x axis will result in an effective translation of the</span>
0211 <span class="comment">% beam coordinates and 'angle' in y, to first order. Assuming that these</span>
0212 <span class="comment">% rotations are small then the change in 's' will be small. Which is why</span>
0213 <span class="comment">% the R1 and R2 matrices are not being used for this purpose.</span>
0214 
0215 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0216 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0217 
0218 xshift = 1e-3;
0219 yshift = 2e-3;
0220 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[xshift 0 yshift 0 0 0],0);
0221 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>)
0222 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>
0223 fprintf(<span class="string">'T1 = [%5.3e %5.3e %5.3e %5.3e %5.3e %5.3e]\n'</span>,THERING{7}.T1);
0224 fprintf(<span class="string">'T2 = [%5.3e %5.3e %5.3e %5.3e %5.3e %5.3e]\n'</span>,THERING{7}.T2);
0225 fprintf(<span class="string">'Expect:\n'</span>);
0226 fprintf(<span class="string">'T1 = [%5.3e 0 %5.3e 0 0 0]\n'</span>,-xshift,-yshift);
0227 fprintf(<span class="string">'T2 = [%5.3e 0 %5.3e 0 0 0]\n'</span>,xshift,yshift);
0228 
0229 
0230 <span class="comment">%%</span>
0231 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0232 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0233 
0234 xrot = 3e-3;
0235 yrot = 3e-3;
0236 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[0 xrot 0 0 0 0],0);
0237 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>)
0238 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>
0239 fprintf(<span class="string">'T1 = [%5.3e %5.3e %5.3e %5.3e %5.3e %5.3e]\n'</span>,THERING{7}.T1);
0240 fprintf(<span class="string">'T2 = [%5.3e %5.3e %5.3e %5.3e %5.3e %5.3e]\n'</span>,THERING{7}.T2);
0241 fprintf(<span class="string">'Expect:\n'</span>);
0242 fprintf(<span class="string">'T1 = [0 0 %5.3e %5.3e 0 0]\n'</span>,-THERING{7}.Length*0.5*tan(xrot),xrot);
0243 fprintf(<span class="string">'T2 = [0 0 %5.3e %5.3e 0 0]\n'</span>,THERING{7}.Length*0.5*tan(xrot),-xrot);
0244 
0245 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0246 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[0 0 0 yrot 0 0],0);
0247 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>)
0248 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>
0249 fprintf(<span class="string">'T1 = [%5.3e %5.3e %5.3e %5.3e %5.3e %5.3e]\n'</span>,THERING{7}.T1);
0250 fprintf(<span class="string">'T2 = [%5.3e %5.3e %5.3e %5.3e %5.3e %5.3e]\n'</span>,THERING{7}.T2);
0251 fprintf(<span class="string">'Expect:\n'</span>);
0252 fprintf(<span class="string">'T1 = [%5.3e %5.3e 0 0 0 0]\n'</span>,THERING{7}.Length*0.5*tan(yrot),-yrot);
0253 fprintf(<span class="string">'T2 = [%5.3e %5.3e 0 0 0 0]\n'</span>,-THERING{7}.Length*0.5*tan(yrot),yrot);
0254 
0255 <span class="comment">%%</span>
0256 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0257 srot = pi/rand;
0258 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0259 <a href="setmisalign.html" class="code" title="function varargout = setmisalign(varargin)">setmisalign</a>(7,[0 0 0 0 0 srot],0);
0260 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>)
0261 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>
0262 fprintf(<span class="string">'%5.3e %5.3e %5.3e %5.3e %5.3e %5.3e\n'</span>,THERING{7}.R1);
0263 fprintf(<span class="string">'Expect\n'</span>);
0264 C = cos(-srot); S = sin(-srot);
0265 temp = [C  0 -S  0  0  0;
0266         0  C  0 -S  0  0;
0267         S  0  C  0  0  0;
0268         0  S  0  C  0  0;
0269         0  0  0  0  1  0;
0270         0  0  0  0  0  1];
0271 fprintf(<span class="string">'%5.3e %5.3e %5.3e %5.3e %5.3e %5.3e\n'</span>,temp);
0272 
0273 
0274 <span class="comment">%% Test SETGIRDERMISALIGN</span>
0275 <span class="comment">%</span>
0276 <span class="comment">% Start with a simple transverse shift, then examine the girder rotations</span>
0277 <span class="comment">% about x and y axes. The s roataion is trivial.</span>
0278 
0279 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0280 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0281 
0282 xshift = 1e-7;
0283 yshift = 2e-7;
0284 <a href="setgirdermisalign.html" class="code" title="function varargout = setgirdermisalign(varargin)">setgirdermisalign</a>(<span class="string">'g1m1'</span>,<span class="string">'g1m2'</span>,[xshift 0 yshift 0 0 0],0);
0285 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'normal'</span>)
0286 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>
0287 <a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a> q1 s1 s2 ind
0288 <a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a> q1 s1 s2
0289 
0290 <span class="comment">%%</span>
0291 <span class="comment">% X rotation of the girder.</span>
0292 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0293 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0294 
0295 xrot = 1e-3;
0296 <a href="setgirdermisalign.html" class="code" title="function varargout = setgirdermisalign(varargin)">setgirdermisalign</a>(<span class="string">'g1m1'</span>,<span class="string">'g1m2'</span>,[0 xrot 0 0 0 0],0);
0297 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>)
0298 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>
0299 <a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a> q1 s1 s2 ind
0300 s11pos = 2.6983+0.05;
0301 s12pos = 2.7983+0.05;
0302 q1pos = 3.0883+.355/2;
0303 s21pos = 3.6083+0.05;
0304 s22pos = 3.7083+0.05;
0305 girdercentre = (3.7083+0.1 + 2.6983)/2;
0306 fprintf(<span class="string">'Expect: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0307     0,xrot,(girdercentre - s11pos)*sin(xrot),0,(girdercentre - s11pos)*(1-cos(xrot)),0);
0308 fprintf(<span class="string">'Expect: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0309     0,xrot,(girdercentre - s12pos)*sin(xrot),0,(girdercentre - s12pos)*(1-cos(xrot)),0);
0310 fprintf(<span class="string">'Expect: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0311     0,xrot,(girdercentre -  q1pos)*sin(xrot),0,(girdercentre -  q1pos)*(1-cos(xrot)),0);
0312 fprintf(<span class="string">'Expect: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0313     0,xrot,(girdercentre - s21pos)*sin(xrot),0,(girdercentre - s21pos)*(1-cos(xrot)),0);
0314 fprintf(<span class="string">'Expect: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0315     0,xrot,(girdercentre - s22pos)*sin(xrot),0,(girdercentre - s22pos)*(1-cos(xrot)),0);
0316 
0317 <span class="comment">%%</span>
0318 <span class="comment">% Y rotation of the girder.</span>
0319 <a href="aspsr_v2simple.html" class="code" title="function aspsr_v2simple(varargin)">aspsr_v2simple</a>;
0320 <a href="deletemisalign.html" class="code" title="function varargout = deletemisalign(varargin)">deletemisalign</a>;
0321 
0322 yrot = 2e-3;
0323 <a href="setgirdermisalign.html" class="code" title="function varargout = setgirdermisalign(varargin)">setgirdermisalign</a>(<span class="string">'g1m1'</span>,<span class="string">'g1m2'</span>,[0 0 0 yrot 0 0],0);
0324 <a href="calcmisalign.html" class="code" title="function varargout = calcmisalign(varargin)">calcmisalign</a>(1,<span class="string">'abs'</span>)
0325 <a href="applymisalign.html" class="code" title="function varargout = applymisalign(varargin)">applymisalign</a>
0326 <a href="printmisalign.html" class="code" title="function varargout = printmisalign(varargin)">printmisalign</a> q1 s1 s2 ind
0327 s11pos = 2.6983+0.05;
0328 s12pos = 2.7983+0.05;
0329 q1pos = 3.0883+.355/2;
0330 s21pos = 3.6083+0.05;
0331 s22pos = 3.7083+0.05;
0332 girdercentre = (3.7083+0.1 + 2.6983)/2;
0333 fprintf(<span class="string">'Expect:\n'</span>);
0334 fprintf(<span class="string">'s1: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0335     (girdercentre - s11pos)*sin(-yrot),0,0,yrot,(girdercentre - s11pos)*(1-cos(-yrot)),0);
0336 fprintf(<span class="string">'s1: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0337     (girdercentre - s12pos)*sin(-yrot),0,0,yrot,(girdercentre - s12pos)*(1-cos(-yrot)),0);
0338 fprintf(<span class="string">'q1: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0339     (girdercentre -  q1pos)*sin(-yrot),0,0,yrot,(girdercentre -  q1pos)*(1-cos(-yrot)),0);
0340 fprintf(<span class="string">'s2: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0341     (girdercentre - s21pos)*sin(-yrot),0,0,yrot,(girdercentre - s21pos)*(1-cos(-yrot)),0);
0342 fprintf(<span class="string">'s2: %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e  |  %5.3e \n'</span>,<span class="keyword">...</span>
0343     (girdercentre - s22pos)*sin(-yrot),0,0,yrot,(girdercentre - s22pos)*(1-cos(-yrot)),0);
0344 
0345 <span class="comment">%%</span>
0346 <span class="comment">% S rotation of the girder.</span></pre></div>
<hr><address>Generated on Sun 28-Jul-2013 23:18:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>