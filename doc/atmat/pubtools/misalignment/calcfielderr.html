<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of calcfielderr</title>
  <meta name="keywords" content="calcfielderr">
  <meta name="description" content="CALCFIELDERR will load the field error data from the base application user">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">atmat</a> &gt; <a href="../index.html">pubtools</a> &gt; <a href="index.html">misalignment</a> &gt; calcfielderr.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for atmat/pubtools/misalignment&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>calcfielderr
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>CALCFIELDERR will load the field error data from the base application user</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function varargout = calcfielderr(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> CALCFIELDERR will load the field error data from the base application user
 data area and calculate the actual error to apply to THERING. This
 is then stored again in the field error data structure.

 CALCFIELDERR(N,DISTTYPE) where N is the number of error seeds to
 generate and DISTTYPE is the type of distribution:

 'normal' -&gt; Normally distributed
 'equal'  -&gt; Flat distribution +-sigma provided and cutoff not used.
 'sho'    -&gt; Simple harmonic oscillator distribution +-sigma (sharp edge)
             and cutoff not used.
 'abs'    -&gt; No random number generated, use sigma as the field error.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="testfielderrors.html" class="code" title="">testfielderrors</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function randnum = generaterandom(sigma,num,cutoff,disttype)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = calcfielderr(varargin)</a>
0002 <span class="comment">% CALCFIELDERR will load the field error data from the base application user</span>
0003 <span class="comment">% data area and calculate the actual error to apply to THERING. This</span>
0004 <span class="comment">% is then stored again in the field error data structure.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% CALCFIELDERR(N,DISTTYPE) where N is the number of error seeds to</span>
0007 <span class="comment">% generate and DISTTYPE is the type of distribution:</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% 'normal' -&gt; Normally distributed</span>
0010 <span class="comment">% 'equal'  -&gt; Flat distribution +-sigma provided and cutoff not used.</span>
0011 <span class="comment">% 'sho'    -&gt; Simple harmonic oscillator distribution +-sigma (sharp edge)</span>
0012 <span class="comment">%             and cutoff not used.</span>
0013 <span class="comment">% 'abs'    -&gt; No random number generated, use sigma as the field error.</span>
0014 
0015 <span class="keyword">global</span> THERING
0016 
0017 <span class="keyword">if</span> ~exist(<span class="string">'THERING'</span>,<span class="string">'var'</span>)
0018     disp(<span class="string">'Please load the model first'</span>);
0019     <span class="keyword">return</span>
0020 <span class="keyword">end</span>
0021 
0022 ferr = getappdata(0,<span class="string">'FielderrData'</span>);
0023 
0024 <span class="keyword">if</span> isempty(ferr)
0025     disp(<span class="string">'No field error data found. See SETFIELDERR for more info'</span>);
0026     <span class="keyword">return</span>
0027 <span class="keyword">end</span>
0028 
0029 <span class="comment">% Parse input data</span>
0030 n = 2;
0031 <span class="keyword">if</span> nargin &gt;= n &amp; ischar(varargin{n})
0032     disttype = varargin{n};
0033 <span class="keyword">else</span>
0034     disp(<span class="string">'Default distribution: normal'</span>);
0035     disttype = <span class="string">'normal'</span>;
0036 <span class="keyword">end</span>
0037 
0038 n = n-1;
0039 <span class="keyword">if</span> nargin &gt;= n &amp; isnumeric(varargin{n})
0040     numseeds = varargin{n};
0041 <span class="keyword">else</span>
0042     disp(<span class="string">'Defaulting number of seeds to 1.'</span>);
0043     numseeds = 1;
0044 <span class="keyword">end</span>
0045 ferr.numseeds = numseeds;
0046 <span class="comment">% Current seed being used on the ring</span>
0047 ferr.currseed = 0;
0048 
0049 <span class="comment">% Set the 'used' parameter to 0 to initialise. Flag used to determine if</span>
0050 <span class="comment">% field errors have been calculated for that element.</span>
0051 <span class="keyword">for</span> i=1:length(THERING)
0052     ferr.data(i).name = THERING{i}.FamName;
0053     ferr.data(i).used = 0;
0054     ferr.data(i).valA = [];
0055     ferr.data(i).valB = [];
0056 <span class="keyword">end</span>
0057 
0058 <span class="comment">% Calculate the random field error values. At the moment the longitudinal</span>
0059 <span class="comment">% shift component, ds, will be ignored as well as thetax, and thetay for</span>
0060 <span class="comment">% the girders. These take more time to compute and at the moment or writing</span>
0061 <span class="comment">% is not seen as being necessary.</span>
0062 
0063 <span class="comment">% Calculate the individual field errors.</span>
0064 <span class="keyword">for</span> i=1:ferr.nind
0065     indices = ferr.ind(i).ATindex;
0066     <span class="comment">% Assumes for the particular group of elements/family the number of</span>
0067     <span class="comment">% polynomials used in the simulation are of the same length.</span>
0068     numPolynomA = length(THERING{indices(1)}.PolynomA);
0069     numPolynomB = length(THERING{indices(1)}.PolynomB);
0070     numSigmaA = length(ferr.ind(i).sigmaA);
0071     numSigmaB = length(ferr.ind(i).sigmaB);
0072     <span class="keyword">if</span> numSigmaA ~= numPolynomA &amp;&amp; numSigmaA ~= 1
0073         fprintf(<span class="string">'Error: Invalid specification of sigmaA for %s\nNOTHING CALCULATED!'</span>,<span class="keyword">...</span>
0074             ferr.ind(i).name);
0075         <span class="keyword">return</span>;
0076     <span class="keyword">end</span>
0077     <span class="keyword">if</span> numSigmaB ~= numPolynomB &amp;&amp; numsigmaB ~= 1
0078         fprintf(<span class="string">'Error: Invalid specification of sigmaB for %s\nNOTHING CALCULATED!'</span>,<span class="keyword">...</span>
0079             ferr.ind(i).name);
0080         <span class="keyword">return</span>
0081     <span class="keyword">end</span>
0082     
0083     <span class="keyword">for</span> j=indices
0084         <span class="keyword">if</span> isempty(ferr.data(j).valA)
0085             ferr.data(j).valA = zeros(numPolynomA,numseeds);
0086         <span class="keyword">end</span>
0087         ferr.data(j).valA = ferr.data(j).valA + <a href="#_sub1" class="code" title="subfunction randnum = generaterandom(sigma,num,cutoff,disttype)">generaterandom</a>(ferr.ind(i).sigmaA,<span class="keyword">...</span>
0088             numseeds,ferr.ind(i).cutoff,disttype);
0089         <span class="keyword">if</span> isempty(ferr.data(j).valB)
0090             ferr.data(j).valB = zeros(numPolynomB,numseeds);
0091         <span class="keyword">end</span>
0092         ferr.data(j).valB = ferr.data(j).valB + <a href="#_sub1" class="code" title="subfunction randnum = generaterandom(sigma,num,cutoff,disttype)">generaterandom</a>(ferr.ind(i).sigmaB,<span class="keyword">...</span>
0093             numseeds,ferr.ind(i).cutoff,disttype);
0094         
0095         <span class="comment">% Flaged for easier search of elements that have been misaligned</span>
0096         ferr.data(j).used = 1;
0097     <span class="keyword">end</span>
0098 <span class="keyword">end</span>
0099 
0100 disp(<span class="string">'Finished calculation the field errors'</span>);
0101 setappdata(0,<span class="string">'FielderrData'</span>,ferr);
0102 
0103 
0104 
0105 <a name="_sub1" href="#_subfunctions" class="code">function randnum = generaterandom(sigma,num,cutoff,disttype)</a>
0106 
0107 numSigval = length(sigma);
0108 <span class="comment">% Each row now represents a different sigma and each column represents a</span>
0109 <span class="comment">% different seed.</span>
0110 sigmatrix = repmat(reshape(sigma,numSigval,1),1,num);
0111 
0112 <span class="keyword">switch</span> disttype
0113     <span class="keyword">case</span> <span class="string">'normal'</span>
0114         <span class="comment">% Normal distribution</span>
0115         <span class="comment">% randnum is a numSigval x num matrix</span>
0116         randnum = sigmatrix.*randn(numSigval, num);
0117         <span class="comment">% If cutoff == 0 then don't cut anything.</span>
0118         <span class="keyword">if</span> cutoff ~= 0
0119             ind = find(abs(randnum) &gt; cutoff*sigmatrix);
0120             <span class="keyword">while</span> ~isempty(ind)
0121                 randnum(ind) = sigmatrix(ind).*randn(length(ind),1);
0122                 ind = find(abs(randnum) &gt; cutoff.*sigmatrix);
0123             <span class="keyword">end</span>
0124         <span class="keyword">end</span>
0125     <span class="keyword">case</span> <span class="string">'equal'</span>
0126         <span class="comment">% Equal/Flat distribution</span>
0127         <span class="comment">% Cutoff ignored completely</span>
0128         randnum = sigmatrix.*(2*rand(numSigval, num) - 1);
0129     <span class="keyword">case</span> <span class="string">'sho'</span>
0130         <span class="comment">% Simple harmonic oscillator distribution</span>
0131         randnum = sigmatrix.*sin(rand(numSigval, num)*2*pi);
0132     <span class="keyword">case</span> <span class="string">'abs'</span>
0133         <span class="comment">% Use the values provided. No randomness.</span>
0134         randnum = sigmatrix;
0135     <span class="keyword">otherwise</span>
0136         disp([<span class="string">'Unknown distribution: '</span> disttype]);
0137         randnum = [];
0138 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 28-Jul-2013 23:18:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>