<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of applyfielderr</title>
  <meta name="keywords" content="applyfielderr">
  <meta name="description" content="APPLYFIELDERR will read the field error data structure and apply it to">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">atmat</a> &gt; <a href="../index.html">pubtools</a> &gt; <a href="index.html">misalignment</a> &gt; applyfielderr.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for atmat/pubtools/misalignment&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>applyfielderr
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>APPLYFIELDERR will read the field error data structure and apply it to</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function varargout = applyfielderr(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> APPLYFIELDERR will read the field error data structure and apply it to
 THERING elements. 

 APPLYFIELDERR([SEED],['quiet']). If more than one seed has been generated using
 CALCFIELDERR then repeated calling of APPLYFIELDERR will apply the
 subsequent seeds untill all have been used and the user will have to
 generate more seeds. The seed that is currently being used is saved in
 the field error datastructure under the field 'currseed'. If SEED is
 defined then that particular seed will be applied and the running
 'currseed' will not be incremented.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="testfielderrors.html" class="code" title="">testfielderrors</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = applyfielderr(varargin)</a>
0002 <span class="comment">% APPLYFIELDERR will read the field error data structure and apply it to</span>
0003 <span class="comment">% THERING elements.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% APPLYFIELDERR([SEED],['quiet']). If more than one seed has been generated using</span>
0006 <span class="comment">% CALCFIELDERR then repeated calling of APPLYFIELDERR will apply the</span>
0007 <span class="comment">% subsequent seeds untill all have been used and the user will have to</span>
0008 <span class="comment">% generate more seeds. The seed that is currently being used is saved in</span>
0009 <span class="comment">% the field error datastructure under the field 'currseed'. If SEED is</span>
0010 <span class="comment">% defined then that particular seed will be applied and the running</span>
0011 <span class="comment">% 'currseed' will not be incremented.</span>
0012 <span class="comment">%</span>
0013 
0014 <span class="keyword">global</span> THERING
0015 
0016 <span class="keyword">if</span> ~exist(<span class="string">'THERING'</span>,<span class="string">'var'</span>)
0017     disp(<span class="string">'Please load the model first'</span>);
0018     <span class="keyword">return</span>
0019 <span class="keyword">end</span>
0020 
0021 [reg prop] = parseparams(varargin);
0022 verbatim = 1;
0023 <span class="keyword">for</span> i=1:length(prop)
0024     <span class="keyword">if</span> strcmpi(prop,<span class="string">'quiet'</span>)
0025         verbatim = 0;
0026     <span class="keyword">end</span>
0027 <span class="keyword">end</span>
0028 
0029 ferr = getappdata(0,<span class="string">'FielderrData'</span>);
0030 
0031 <span class="keyword">if</span> isempty(ferr)
0032     disp(<span class="string">'No field error data found. See SETFIELDERR for more info'</span>);
0033     <span class="keyword">return</span>
0034 <span class="keyword">end</span>
0035 
0036 <span class="keyword">if</span> nargin == 1 &amp; isnumeric(varargin{1})
0037     ferr.currseed = varargin{1};
0038 <span class="keyword">else</span>
0039     ferr.currseed = ferr.currseed + 1;
0040     <span class="keyword">if</span> ferr.currseed &gt; ferr.numseeds
0041         disp(<span class="string">'All seeds used. Doing nothing'</span>)
0042         <span class="keyword">return</span>
0043     <span class="keyword">end</span>
0044 <span class="keyword">end</span>
0045     
0046 <span class="comment">% Indices of elements where field error data may need to be applied.</span>
0047 indices = find(cell2mat({ferr.data.used}));
0048 <span class="keyword">for</span> i=indices
0049     THERING{i}.PolynomA = THERING{i}.PolynomA + ferr.data(i).valA(:,ferr.currseed)';
0050     THERING{i}.PolynomB = THERING{i}.PolynomB + ferr.data(i).valB(:,ferr.currseed)';
0051     <span class="keyword">if</span> isfield(THERING{i},<span class="string">'K'</span>)
0052         THERING{i}.K = THERING{i}.PolynomB(2);
0053     <span class="keyword">end</span>
0054 <span class="keyword">end</span>
0055 
0056 <span class="keyword">if</span> verbatim
0057     disp([<span class="string">'Applied random field error. Using seed number '</span> num2str(ferr.currseed)]);
0058 <span class="keyword">end</span>
0059 
0060 <span class="comment">% Saving some info for plotting and analysis of applied field errors</span>
0061 <span class="comment">% get the SPos data</span>
0062 <span class="comment">% TD3 = twissring(THERING,0,1:length(THERING));</span>
0063 <span class="comment">% S3 = cat(2,TD3.SPos);</span>
0064 <span class="comment">% ferr.applied(ferr.currseed).spos = S3;</span>
0065 <span class="comment">% ferr.applied(ferr.currseed).deltax = zeros(1,length(THERING));</span>
0066 <span class="comment">% ferr.applied(ferr.currseed).deltax(indices) = xshift;</span>
0067 <span class="comment">% ferr.applied(ferr.currseed).deltay = zeros(1,length(THERING));</span>
0068 <span class="comment">% ferr.applied(ferr.currseed).deltay(indices) = yshift;</span>
0069 <span class="comment">% ferr.applied(ferr.currseed).deltas = zeros(1,length(THERING));</span>
0070 <span class="comment">% ferr.applied(ferr.currseed).deltas(indices) = sshift;</span>
0071 
0072 
0073 setappdata(0,<span class="string">'FielderrData'</span>,ferr);</pre></div>
<hr><address>Generated on Sun 28-Jul-2013 23:18:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>