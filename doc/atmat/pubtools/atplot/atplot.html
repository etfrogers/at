<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of atplot</title>
  <meta name="keywords" content="atplot">
  <meta name="description" content="ATPLOT Plots optical functions">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">atmat</a> &gt; <a href="../index.html">pubtools</a> &gt; <a href="index.html">atplot</a> &gt; atplot.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for atmat/pubtools/atplot&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>atplot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>ATPLOT Plots optical functions</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function curve = atplot(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">ATPLOT Plots optical functions

ATPLOT                 Plots THERING in the current axes

ATPLOT(RING)           Plots the lattice specified by RING

ATPLOT(AX,RING)        Plots in the axes specified by AX

ATPLOT(AX,RING,DPP)    Plots at momentum deviation DPP

ATPLOT(...,[SMIN SMAX])  Zoom on the specified range

ATPLOT(...,@PLOTFUNCTION,args...)
    Allows for a user supplied function providing the values to be plotted
   PLOTFUNCTION must be of form:
   PLOTDATA=PLOTFUNCTION(LINDATA,RING,DPP,args...)

       PLOTDATA is a structure array,
       PLOTDATA(1) describes data for the left axis
           PLOTDATA(1).VALUES: data to be plotted length(ring)+1 X nbcurve
           PLOTDATA(1).LABELS: curve labela, cell array, 1 X nbcurve
           PLOTDATA(1).AXISLABEL: string
       PLOTDATA(2) optional, describes data for the left axis

   The default function displayed below as an example plots beta functions
    and dispersion

 function plotdata=defaultplot(lindata,ring,dpp,varargin)
 beta=cat(1,lindata.beta);                     % left axis
 plotdata(1).values=beta;
 plotdata(1).labels={'\beta_x','\beta_z'};
 plotdata(1).axislabel='\beta [m]';
 dispersion=cat(2,lindata.Dispersion)';        % right axis
 plotdata(2).values=dispersion(:,1);
 plotdata(2).labels={'\eta_x'};
 plotdata(2).axislabel='dispersion [m]';
 end

CURVE=ATPLOT(...) Returns handles to some objects:
   CURVE.LEFT      Handles to the left axis plots
   CURVE.RIGHT     Handles to the right axis plots
   CURVE.LATTICE    Handles to the Element patches
   CURVE.COMMENT    Handles to the Comment text

See also: atplot&gt;defaultplot</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="atplotsyn.html" class="code" title="function pp = atplotsyn(ax,ring)">atplotsyn</a>	ATPLOTSYN Helper function for ATPLOT</li><li><a href="atslice.html" class="code" title="function slicedring = atslice(ring,npts)">atslice</a>	ATSLICE Splits ring elements in short slices for plotting</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function axclean(ax)</a></li><li><a href="#_sub2" class="code">function plotdata=defaultplot(lindata,ring,dpp,varargin)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function curve = atplot(varargin)</a>
0002 <span class="comment">%ATPLOT Plots optical functions</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%ATPLOT                 Plots THERING in the current axes</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%ATPLOT(RING)           Plots the lattice specified by RING</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%ATPLOT(AX,RING)        Plots in the axes specified by AX</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%ATPLOT(AX,RING,DPP)    Plots at momentum deviation DPP</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%ATPLOT(...,[SMIN SMAX])  Zoom on the specified range</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%ATPLOT(...,@PLOTFUNCTION,args...)</span>
0015 <span class="comment">%    Allows for a user supplied function providing the values to be plotted</span>
0016 <span class="comment">%   PLOTFUNCTION must be of form:</span>
0017 <span class="comment">%   PLOTDATA=PLOTFUNCTION(LINDATA,RING,DPP,args...)</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%       PLOTDATA is a structure array,</span>
0020 <span class="comment">%       PLOTDATA(1) describes data for the left axis</span>
0021 <span class="comment">%           PLOTDATA(1).VALUES: data to be plotted length(ring)+1 X nbcurve</span>
0022 <span class="comment">%           PLOTDATA(1).LABELS: curve labela, cell array, 1 X nbcurve</span>
0023 <span class="comment">%           PLOTDATA(1).AXISLABEL: string</span>
0024 <span class="comment">%       PLOTDATA(2) optional, describes data for the left axis</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   The default function displayed below as an example plots beta functions</span>
0027 <span class="comment">%    and dispersion</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% function plotdata=defaultplot(lindata,ring,dpp,varargin)</span>
0030 <span class="comment">% beta=cat(1,lindata.beta);                     % left axis</span>
0031 <span class="comment">% plotdata(1).values=beta;</span>
0032 <span class="comment">% plotdata(1).labels={'\beta_x','\beta_z'};</span>
0033 <span class="comment">% plotdata(1).axislabel='\beta [m]';</span>
0034 <span class="comment">% dispersion=cat(2,lindata.Dispersion)';        % right axis</span>
0035 <span class="comment">% plotdata(2).values=dispersion(:,1);</span>
0036 <span class="comment">% plotdata(2).labels={'\eta_x'};</span>
0037 <span class="comment">% plotdata(2).axislabel='dispersion [m]';</span>
0038 <span class="comment">% end</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%CURVE=ATPLOT(...) Returns handles to some objects:</span>
0041 <span class="comment">%   CURVE.LEFT      Handles to the left axis plots</span>
0042 <span class="comment">%   CURVE.RIGHT     Handles to the right axis plots</span>
0043 <span class="comment">%   CURVE.LATTICE    Handles to the Element patches</span>
0044 <span class="comment">%   CURVE.COMMENT    Handles to the Comment text</span>
0045 <span class="comment">%</span>
0046 <span class="comment">%See also: atplot&gt;defaultplot</span>
0047 <span class="keyword">global</span> THERING
0048 
0049 narg=1;
0050 plotfun=@<a href="#_sub2" class="code" title="subfunction plotdata=defaultplot(lindata,ring,dpp,varargin) ">defaultplot</a>;
0051 <span class="comment">% Select axes for the plot</span>
0052 <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; isscalar(varargin{narg}) &amp;&amp; ishandle(varargin{narg});
0053     ax=varargin{narg};
0054     narg=narg+1;
0055 <span class="keyword">else</span>
0056     ax=gca;
0057 <span class="keyword">end</span>
0058 <span class="comment">% Select the lattice</span>
0059 <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; iscell(varargin{narg});
0060     ring0=varargin{narg};
0061     narg=narg+1;
0062 <span class="keyword">else</span>
0063     ring0=THERING;
0064 <span class="keyword">end</span>
0065 <span class="comment">% Keep only one superperiod and change the harmonic number</span>
0066 [elt0,nperiods]=size(ring0);
0067 <span class="keyword">if</span> nperiods &gt; 1
0068     ring1=ring0(:,1);
0069     cavindex=atgetcells(ring1,<span class="string">'HarmNumber'</span>);
0070     ring0=setcellstruct(ring1,<span class="string">'HarmNumber'</span>,cavindex,getcellstruct(ring1,<span class="string">'HarmNumber'</span>,cavindex)/nperiods);
0071 <span class="keyword">end</span>
0072 <span class="comment">% Select the momentum deviation</span>
0073 <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; isscalar(varargin{narg}) &amp;&amp; isnumeric(varargin{narg});
0074     dpp=varargin{narg};
0075     narg=narg+1;
0076 <span class="keyword">else</span>
0077     dpp=0;
0078 <span class="keyword">end</span>
0079 s0=findspos(ring0,1:elt0+1);
0080 srange=s0([1 end]);     <span class="comment">%default plot range</span>
0081 el1=1;
0082 el2=elt0+1;
0083 
0084 firstarg=nargin+1;
0085 <span class="keyword">for</span> iarg=narg:nargin
0086     <span class="comment">% explicit plot range</span>
0087     <span class="keyword">if</span> isnumeric(varargin{iarg}) &amp;&amp; (numel(varargin{iarg})==2)
0088         srange=varargin{iarg};
0089         els=find(srange(1)&gt;s0,1,<span class="string">'last'</span>);
0090         <span class="keyword">if</span> ~isempty(els), el1=els; <span class="keyword">end</span>
0091         els=find(s0&gt;srange(2),1,<span class="string">'first'</span>);
0092         <span class="keyword">if</span> ~isempty(els), el2=els; <span class="keyword">end</span>
0093     <span class="keyword">elseif</span> isa(varargin{iarg},<span class="string">'function_handle'</span>)
0094         plotfun=varargin{iarg};
0095         firstarg=iarg+1;
0096         <span class="keyword">break</span>
0097     <span class="keyword">else</span>
0098         firstarg=iarg;
0099         <span class="keyword">break</span>
0100     <span class="keyword">end</span>
0101 <span class="keyword">end</span>
0102 
0103 <span class="comment">%ring=[ring0((1:el1-1)');atslice(ring0(el1:el2-1),250);ring0((el2:elt0)')];</span>
0104 ring=[ring0(1:el1-1,1);<a href="atslice.html" class="code" title="function slicedring = atslice(ring,npts)">atslice</a>(ring0(el1:el2-1,1),250);ring0(el2:elt0,1)];
0105 elt=length(ring);
0106 plrange=el1:el2+elt-elt0;
0107 [lindata,tuneper,chrom]=atlinopt(ring,dpp,1:elt+1); <span class="comment">%#ok&lt;NASGU,ASGLU&gt;</span>
0108 s=cat(1,lindata.SPos);
0109 
0110 <span class="comment">%axclean(ax);</span>
0111 set(ax,<span class="string">'Position'</span>,[.13 .11 .775 .775],<span class="string">'FontSize'</span>,12);
0112 outp=plotfun(lindata,ring,dpp,varargin{firstarg:nargin});
0113 labels=[outp.labels];
0114 <span class="keyword">if</span> numel(outp) &gt;= 2
0115     [ax2,h1,h2]=plotyy(ax,s(plrange),outp(1).values(plrange,:),s(plrange),outp(2).values(plrange,:));
0116     set(ax2(2),<span class="string">'XTick'</span>,[],<span class="string">'FontSize'</span>,12);
0117     ylabel(ax2(1),outp(1).axislabel);
0118     ylabel(ax2(2),outp(2).axislabel);
0119 <span class="keyword">else</span>
0120     h1=plot(ax,s(plrange),outp(1).values(plrange,:));
0121     h2=[];
0122     ax2=ax;
0123     ylabel(ax,outp(1).axislabel);
0124 <span class="keyword">end</span>
0125 curve.left=h1;
0126 curve.right=h2;
0127 curve.lattice=<a href="atplotsyn.html" class="code" title="function pp = atplotsyn(ax,ring)">atplotsyn</a>(ax2(1),ring0);  <span class="comment">% Plot lattice elements</span>
0128 lts=get(ax2(1),<span class="string">'Children'</span>);             <span class="comment">% Put them in the background</span>
0129 set(ax2(1),<span class="string">'Children'</span>,[lts(4:end);lts(1:3)]);
0130 set([h1;h2],<span class="string">'LineWidth'</span>,1);
0131 set(ax2,<span class="string">'XLim'</span>,srange);
0132 xlabel(ax2(1),<span class="string">'s [m]'</span>);                 <span class="comment">% Add labels</span>
0133 legend([h1;h2],labels{:});
0134 grid on
0135 <span class="comment">% axes(ax);</span>
0136 tuneper=lindata(end).mu/2/pi;
0137 tunes=nperiods*tuneper;
0138 circ=nperiods*s0(end);
0139 <span class="keyword">if</span> nperiods &gt; 1, plural=<span class="string">'s'</span>; <span class="keyword">else</span> plural=<span class="string">''</span>; <span class="keyword">end</span>
0140 line1=sprintf(<span class="string">'\\nu_x=%8.3f      \\deltap/p=%.3f%i %s'</span>,tunes(1),dpp);
0141 line2=sprintf(<span class="string">'\\nu_z=%8.3f      %2i %s, C=%10.3f'</span>,tunes(2),nperiods,<span class="keyword">...</span>
0142     [<span class="string">'period'</span> plural],circ);
0143 curve.comment=text(-0.14,1.12,{line1;line2},<span class="string">'Units'</span>,<span class="string">'normalized'</span>,<span class="keyword">...</span>
0144     <span class="string">'VerticalAlignment'</span>,<span class="string">'top'</span>,<span class="string">'FontSize'</span>,12);
0145 
0146     <a name="_sub1" href="#_subfunctions" class="code">function axclean(ax)</a>
0147         cla(ax,<span class="string">'reset'</span>);
0148         appd=fieldnames(getappdata(ax));
0149         <span class="keyword">for</span> as=appd'
0150             rmappdata(ax,as{1});
0151         <span class="keyword">end</span>
0152         fig=get(ax,<span class="string">'Parent'</span>);
0153         axs=get(fig,<span class="string">'Children'</span>);
0154         <span class="keyword">for</span> testax=axs'
0155             testax
0156             getappdata(testax)
0157         <span class="keyword">end</span>
0158     <span class="keyword">end</span>
0159 <span class="keyword">end</span>
0160 
0161 <a name="_sub2" href="#_subfunctions" class="code">function plotdata=defaultplot(lindata,ring,dpp,varargin) </a><span class="comment">%#ok&lt;INUSD&gt;</span>
0162 <span class="comment">%DEFAULTPLOT    Default plotting function for ATPLOT</span>
0163 <span class="comment">%</span>
0164 <span class="comment">%Plots beta-functions on left axis and dispersion on right axis</span>
0165 
0166 beta=cat(1,lindata.beta);
0167 plotdata(1).values=beta;
0168 plotdata(1).labels={<span class="string">'\beta_x'</span>,<span class="string">'\beta_z'</span>};
0169 plotdata(1).axislabel=<span class="string">'\beta [m]'</span>;
0170 dispersion=cat(2,lindata.Dispersion)';
0171 plotdata(2).values=dispersion(:,1);
0172 plotdata(2).labels={<span class="string">'\eta_x'</span>};
0173 plotdata(2).axislabel=<span class="string">'dispersion [m]'</span>;
0174 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 28-Jul-2013 23:18:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>